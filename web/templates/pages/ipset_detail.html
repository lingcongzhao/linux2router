{{define "content"}}
<div class="space-y-6">
    <div class="md:flex md:items-center md:justify-between">
        <div class="min-w-0 flex-1">
            <nav class="flex mb-2" aria-label="Breadcrumb">
                <ol class="flex items-center space-x-2">
                    <li>
                        <a href="/ipset" class="text-sm text-gray-500 hover:text-gray-700">IPSets</a>
                    </li>
                    <li>
                        <svg class="h-5 w-5 flex-shrink-0 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                        </svg>
                    </li>
                    <li class="text-sm font-medium text-gray-900">{{.Set.Name}}</li>
                </ol>
            </nav>
            <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
                {{.Set.Name}}
            </h2>
        </div>
        <div class="mt-4 flex md:ml-4 md:mt-0 space-x-2">
            <button class="btn btn-warning"
                    data-confirm-message="Flush all entries from {{.Set.Name}}?"
                    data-confirm-action="/ipset/{{.Set.Name}}/flush"
                    data-confirm-method="POST">
                Flush All
            </button>
        </div>
    </div>

    <div id="alert-container"></div>

    <!-- Set Info -->
    <div class="card">
        <div class="card-header">
            <h3 class="text-base font-semibold leading-6 text-gray-900">Set Information</h3>
        </div>
        <div class="card-body">
            <dl class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                    <dt class="text-sm font-medium text-gray-500">Type</dt>
                    <dd class="mt-1 text-sm text-gray-900">{{.Set.Type}}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Family</dt>
                    <dd class="mt-1 text-sm text-gray-900">{{.Set.Family}}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Entries</dt>
                    <dd class="mt-1 text-sm text-gray-900">{{.Set.NumEntries}} / {{.Set.MaxElem}}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Memory</dt>
                    <dd class="mt-1 text-sm text-gray-900">{{formatBytes (uint64 .Set.MemSize)}}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Hash Size</dt>
                    <dd class="mt-1 text-sm text-gray-900">{{.Set.HashSize}}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Timeout</dt>
                    <dd class="mt-1 text-sm text-gray-900">{{if gt .Set.Timeout 0}}{{.Set.Timeout}}s{{else}}None{{end}}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">References</dt>
                    <dd class="mt-1 text-sm text-gray-900">
                        {{if gt .Set.References 0}}
                        <span class="badge badge-blue">{{.Set.References}} iptables rules</span>
                        {{else}}
                        <span class="text-gray-400">Not referenced</span>
                        {{end}}
                    </dd>
                </div>
            </dl>
        </div>
    </div>

    <!-- Add Entry Form -->
    <div class="card">
        <div class="card-header">
            <h3 class="text-base font-semibold leading-6 text-gray-900">Add Entry</h3>
        </div>
        <div class="card-body">
            <form hx-post="/ipset/{{.Set.Name}}/entries" hx-target="#alert-container" hx-swap="innerHTML" class="flex flex-wrap gap-4 items-end">
                <div class="flex-1 min-w-[200px]">
                    <label class="form-label">Entry</label>
                    <input type="text" name="entry" required class="form-input" placeholder="{{if eq .Set.Type "hash:ip"}}192.168.1.100{{else if eq .Set.Type "hash:net"}}192.168.0.0/24{{else if eq .Set.Type "hash:ip,port"}}192.168.1.100,tcp:80{{else}}value{{end}}">
                </div>
                <div class="w-32">
                    <label class="form-label">Timeout (s)</label>
                    <input type="number" name="timeout" min="0" class="form-input" placeholder="0">
                </div>
                <div class="flex-1 min-w-[150px]">
                    <label class="form-label">Comment</label>
                    <input type="text" name="comment" class="form-input" placeholder="Optional">
                </div>
                <button type="submit" class="btn btn-primary">Add Entry</button>
            </form>
        </div>
    </div>

    <!-- Entries Table -->
    <div id="entries-content"
         hx-get="/ipset/{{.Set.Name}}/entries"
         hx-trigger="every 10s, refresh from:body"
         hx-swap="innerHTML">
        {{template "ipset_entries_table" .}}
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirm-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75" onclick="closeConfirmModal()"></div>
    <div class="flex min-h-full items-center justify-center p-4">
        <div class="relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl sm:my-8 sm:w-full sm:max-w-md sm:p-6">
            <div class="sm:flex sm:items-start">
                <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                    <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                    </svg>
                </div>
                <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                    <h3 class="text-base font-semibold leading-6 text-gray-900">Confirm Action</h3>
                    <div class="mt-2">
                        <p class="text-sm text-gray-500" id="confirm-modal-message">Are you sure?</p>
                    </div>
                </div>
            </div>
            <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                <button type="button" id="confirm-modal-yes" onclick="confirmAction()" class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto">
                    Confirm
                </button>
                <button type="button" onclick="closeConfirmModal()" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</div>

<!-- All JS functions are in /static/js/app.js (global) -->
{{end}}

{{define "ipset_entries_table"}}
<div class="card">
    <div class="card-header flex justify-between items-center">
        <h3 class="text-base font-semibold leading-6 text-gray-900">Entries ({{len .Set.Entries}})</h3>
    </div>
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Entry</th>
                    <th class="text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                {{$setName := .Set.Name}}
                {{range .Set.Entries}}
                <tr>
                    <td class="mono">{{.}}</td>
                    <td class="text-right">
                        <button class="btn btn-sm btn-danger"
                                data-confirm-message="Delete entry {{.}}?"
                                data-confirm-action="/ipset/{{$setName}}/entries"
                                data-confirm-method="DELETE"
                                data-confirm-body="entry={{.}}">
                            Delete
                        </button>
                    </td>
                </tr>
                {{else}}
                <tr>
                    <td colspan="2" class="text-center text-gray-500">No entries in this set</td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
</div>
{{end}}

{{template "base" .}}
